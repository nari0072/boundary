# 2223のfull relax
full relaxにともなうエネルギー変化は次のとおり．
```
bob% grep 'F=' test_2223.o2115 
   1 F= -.11132646E+03 E0= -.11132778E+03  d E =-.111326E+03
   2 F= -.11172799E+03 E0= -.11172838E+03  d E =-.401532E+00
   3 F= -.11191525E+03 E0= -.11191441E+03  d E =-.588787E+00
   4 F= -.11206966E+03 E0= -.11206882E+03  d E =-.154417E+00
   5 F= -.11209149E+03 E0= -.11209072E+03  d E =-.176241E+00
   6 F= -.11219786E+03 E0= -.11219676E+03  d E =-.106370E+00
   7 F= -.11225505E+03 E0= -.11225345E+03  d E =-.163562E+00
   8 F= -.11232704E+03 E0= -.11232575E+03  d E =-.719878E-01
   9 F= -.11235115E+03 E0= -.11235037E+03  d E =-.961003E-01
  10 F= -.11238849E+03 E0= -.11238769E+03  d E =-.373406E-01
  11 F= -.11238900E+03 E0= -.11238819E+03  d E =-.378452E-01
  12 F= -.11241411E+03 E0= -.11241311E+03  d E =-.251193E-01
  13 F= -.11241583E+03 E0= -.11241476E+03  d E =-.268301E-01
  14 F= -.11242937E+03 E0= -.11242786E+03  d E =-.135404E-01
  15 F= -.11242954E+03 E0= -.11242800E+03  d E =-.137187E-01
  16 F= -.11243557E+03 E0= -.11243391E+03  d E =-.602943E-02
  17 F= -.11243559E+03 E0= -.11243392E+03  d E =-.604595E-02
  18 F= -.11244115E+03 E0= -.11243936E+03  d E =-.555555E-02
  19 F= -.11244192E+03 E0= -.11244008E+03  d E =-.633048E-02
  20 F= -.11244522E+03 E0= -.11244326E+03  d E =-.330298E-02
  21 F= -.11244522E+03 E0= -.11244326E+03  d E =-.330303E-02
  22 F= -.11244754E+03 E0= -.11244553E+03  d E =-.231606E-02
  23 F= -.11244764E+03 E0= -.11244563E+03  d E =-.241367E-02
  24 F= -.11244980E+03 E0= -.11244784E+03  d E =-.215963E-02
  25 F= -.11245016E+03 E0= -.11244825E+03  d E =-.251901E-02
  26 F= -.11245202E+03 E0= -.11245015E+03  d E =-.186827E-02
  27 F= -.11245230E+03 E0= -.11245045E+03  d E =-.214208E-02
  28 F= -.11245380E+03 E0= -.11245202E+03  d E =-.150133E-02
  29 F= -.11245422E+03 E0= -.11245250E+03  d E =-.191939E-02
  30 F= -.11245552E+03 E0= -.11245387E+03  d E =-.130476E-02
  31 F= -.11245599E+03 E0= -.11245440E+03  d E =-.176964E-02
  32 F= -.11245719E+03 E0= -.11245575E+03  d E =-.120634E-02
  33 F= -.11245734E+03 E0= -.11245597E+03  d E =-.135567E-02
  34 F= -.11245812E+03 E0= -.11245689E+03  d E =-.775031E-03
  35 F= -.11245812E+03 E0= -.11245688E+03  d E =-.775412E-03
  36 F= -.11245852E+03 E0= -.11245740E+03  d E =-.400417E-03
```
この結果として得られたCONTCARでは，
```
bob% head CONTCAR
(Al)4  (Fm-3m)                          
   1.00000000000000     
    11.3867605961746481    0.0100935929319685   -0.0017461789180479
     0.0041105062482931    6.3305944602789737   -0.0005256693932857
    -0.0010552304551614   -0.0005576642430577    7.7999169997776718
  31
Selective dynamics
Direct
  0.5019345932650742  0.0175829760695645  0.0006520403994781   T   T   T
  0.6636735094973117  0.1109682191450655  0.2513793324124630   T   T   T
```
となっており，初期値，
```
cat POSCAR_2223_4 
(Al)4  (Fm-3m) 
1.000000
11.502026 0.000000 0.000000
0.000000 6.286319 0.000000
0.000000 0.000000 8.082800
31
Selective dynamics
Direct
  0.500000  0.000000  0.000000 T T T
  0.666667  0.101650  0.250000 T T T
```
からそれなりに動いています．どの程度の変化かというと，
```
x = 0.98997-1 = -0.0100
y = 1.0070- 1 =  0.0070
z = 0.9650- 1 = -0.0345
```
です．z軸がこんなに動いているのはなんでかな．．．ちょっと気になる．

x,y軸だけを振ってみようと思っていましたが，それではだめかも．一応そのまま進めてみます．

# script
自動変更するスクリプトauto_expand.rbによってx,y軸を変更している．
あまり一度に多くを投げると間違いがあると困るので，初期は，dy=0で動かしている．
INCARのISIFを3から2に変更して，内部緩和だけを実行するにようにしている．

auto_expand.rbの内容は次の通り．
```ruby
cat auto_expand.rb 
require 'fileutils'

p file = ARGV[0]
lines = File.readlines(file)
count = 0
[-2,-1,0,1,2].each{|x_val|
  [0].each{|y_val|
#  [-2,-1,0,1,2].each{|y_val|

    # confirm condition
    p count
    p [x_val/100.0,y_val/100.0]

    # calc expanded x,y vectors
    p x0=lines[2].split(/\s/)[0].to_f
    p xx=x0*(1.0+x_val/100.0)
    p lines[2].sub!(x0.to_s,xx.to_s)
    p lines[2]
    p y0=lines[3].split(/\s/)[1].to_f
    p yy=y0*(1.0+y_val/100.0)
    p lines[3].sub!(y0.to_s,yy.to_s)
    p lines[3]

    # mkdir and write POSCAR
    dir = "#{count}_calc"
    Dir.mkdir(dir) unless File.exists?(dir)
    t_file = File.open(File.join(dir,'POSCAR'),'w')
    lines.each{|line| t_file.print(line)}
    t_file.close

    # set other CARs
    FileUtils.cp('POTCAR',dir,:verbose=>true)
    FileUtils.cp('INCAR',dir,:verbose=>true)
    FileUtils.cp('KPOINTS',dir,:verbose=>true)
    count += 1
  }
}
```

# 緩和計算結果
## 2223
```
sprintf("%10.5f eV, %10.5f J/m^2 (area:%10.5f A^2)\n",
                   d_energy, d_energy/(yy*zz)*1.60218*10/2, yy*zz)
> -.11236558E+03-31*(-3.739501247);
                                                       3.5589587

> %/(6.2863189 * 8.0828);
                                                     0.07004299480

> %*1.60218*10/2;
                                                     0.5611074270
```
561.1mJ/m^2ですな．

```
/home/bob/2223/innerelax/succeeded/inner_relax_1_1
-112.30096:0.5600386596598604
/home/bob/2223/innerelax/succeeded/inner_relax_0_0
-112.36558:0.5611074113950909
/home/bob/2223/innerelax/succeeded/inner_relax_1_0
-112.32077:0.562546713905762
/home/bob/2223/innerelax/succeeded/inner_relax_1_2
-112.22028:0.5668396814337117
/home/bob/2223/innerelax/succeeded/inner_relax_1_3
-112.02133:0.591370062890737
/home/bob/2223/innerelax/succeeded/inner_relax_0_3
-112.36584:0.5610664196497437
/home/bob/2223/innerelax/succeeded/inner_relax_0_4
-112.25893:0.5779219100146739
/home/bob/2223/innerelax/succeeded/inner_relax_1_4
-111.59533:0.6494185825492714
/home/bob/2223/innerelax/succeeded/inner_relax_0_2
-112.37954:0.5589064699911566
/home/bob/2223/innerelax/succeeded/inner_relax_0_1
-112.37954:0.5589064699911566
```

さてgnuplot．いつも忘れてしまうな．．．
