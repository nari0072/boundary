<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: relax_res
  
    &mdash; Documentation by YARD 0.9.5
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "relax_res";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: relax_res</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="file_list.html"></iframe>

      <div id="content"><div id='filecontents'><h1>2223のfull relax</h1>

<p>full relaxにともなうエネルギー変化は次のとおり．</p>

<pre class="code ruby"><code class="ruby">bob% grep &#39;F=&#39; test_2223.o2115 
   1 F= -.11132646E+03 E0= -.11132778E+03  d E =-.111326E+03
   2 F= -.11172799E+03 E0= -.11172838E+03  d E =-.401532E+00
   3 F= -.11191525E+03 E0= -.11191441E+03  d E =-.588787E+00
   4 F= -.11206966E+03 E0= -.11206882E+03  d E =-.154417E+00
   5 F= -.11209149E+03 E0= -.11209072E+03  d E =-.176241E+00
   6 F= -.11219786E+03 E0= -.11219676E+03  d E =-.106370E+00
   7 F= -.11225505E+03 E0= -.11225345E+03  d E =-.163562E+00
   8 F= -.11232704E+03 E0= -.11232575E+03  d E =-.719878E-01
   9 F= -.11235115E+03 E0= -.11235037E+03  d E =-.961003E-01
  10 F= -.11238849E+03 E0= -.11238769E+03  d E =-.373406E-01
  11 F= -.11238900E+03 E0= -.11238819E+03  d E =-.378452E-01
  12 F= -.11241411E+03 E0= -.11241311E+03  d E =-.251193E-01
  13 F= -.11241583E+03 E0= -.11241476E+03  d E =-.268301E-01
  14 F= -.11242937E+03 E0= -.11242786E+03  d E =-.135404E-01
  15 F= -.11242954E+03 E0= -.11242800E+03  d E =-.137187E-01
  16 F= -.11243557E+03 E0= -.11243391E+03  d E =-.602943E-02
  17 F= -.11243559E+03 E0= -.11243392E+03  d E =-.604595E-02
  18 F= -.11244115E+03 E0= -.11243936E+03  d E =-.555555E-02
  19 F= -.11244192E+03 E0= -.11244008E+03  d E =-.633048E-02
  20 F= -.11244522E+03 E0= -.11244326E+03  d E =-.330298E-02
  21 F= -.11244522E+03 E0= -.11244326E+03  d E =-.330303E-02
  22 F= -.11244754E+03 E0= -.11244553E+03  d E =-.231606E-02
  23 F= -.11244764E+03 E0= -.11244563E+03  d E =-.241367E-02
  24 F= -.11244980E+03 E0= -.11244784E+03  d E =-.215963E-02
  25 F= -.11245016E+03 E0= -.11244825E+03  d E =-.251901E-02
  26 F= -.11245202E+03 E0= -.11245015E+03  d E =-.186827E-02
  27 F= -.11245230E+03 E0= -.11245045E+03  d E =-.214208E-02
  28 F= -.11245380E+03 E0= -.11245202E+03  d E =-.150133E-02
  29 F= -.11245422E+03 E0= -.11245250E+03  d E =-.191939E-02
  30 F= -.11245552E+03 E0= -.11245387E+03  d E =-.130476E-02
  31 F= -.11245599E+03 E0= -.11245440E+03  d E =-.176964E-02
  32 F= -.11245719E+03 E0= -.11245575E+03  d E =-.120634E-02
  33 F= -.11245734E+03 E0= -.11245597E+03  d E =-.135567E-02
  34 F= -.11245812E+03 E0= -.11245689E+03  d E =-.775031E-03
  35 F= -.11245812E+03 E0= -.11245688E+03  d E =-.775412E-03
  36 F= -.11245852E+03 E0= -.11245740E+03  d E =-.400417E-03
</code></pre>

<p>この結果として得られたCONTCARでは，</p>

<pre class="code ruby"><code class="ruby">bob% head CONTCAR
(Al)4  (Fm-3m)                          
   1.00000000000000     
    11.3867605961746481    0.0100935929319685   -0.0017461789180479
     0.0041105062482931    6.3305944602789737   -0.0005256693932857
    -0.0010552304551614   -0.0005576642430577    7.7999169997776718
  31
Selective dynamics
Direct
  0.5019345932650742  0.0175829760695645  0.0006520403994781   T   T   T
  0.6636735094973117  0.1109682191450655  0.2513793324124630   T   T   T
</code></pre>

<p>となっており，初期値，</p>

<pre class="code ruby"><code class="ruby">cat POSCAR_2223_4 
(Al)4  (Fm-3m) 
1.000000
11.502026 0.000000 0.000000
0.000000 6.286319 0.000000
0.000000 0.000000 8.082800
31
Selective dynamics
Direct
  0.500000  0.000000  0.000000 T T T
  0.666667  0.101650  0.250000 T T T
</code></pre>

<p>からそれなりに動いています．どの程度の変化かというと，</p>

<pre class="code ruby"><code class="ruby">x = 0.98997-1 = -0.0100
y = 1.0070- 1 =  0.0070
z = 0.9650- 1 = -0.0345
</code></pre>

<p>です．z軸がこんなに動いているのはなんでかな．．．ちょっと気になる．</p>

<p>x,y軸だけを振ってみようと思っていましたが，それではだめかも．一応そのまま進めてみます．</p>

<h1>script</h1>

<p>自動変更するスクリプトauto_expand.rbによってx,y軸を変更している．
あまり一度に多くを投げると間違いがあると困るので，初期は，dy=0で動かしている．
INCARのISIFを3から2に変更して，内部緩和だけを実行するにようにしている．</p>

<p>auto_expand.rbの内容は次の通り．</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cat'>cat</span> <span class='id identifier rubyid_auto_expand'>auto_expand</span><span class='period'>.</span><span class='id identifier rubyid_rb'>rb</span> 
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>fileutils</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_file'>file</span> <span class='op'>=</span> <span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_readlines'>readlines</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
<span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='lbracket'>[</span><span class='op'>-</span><span class='int'>2</span><span class='comma'>,</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x_val'>x_val</span><span class='op'>|</span>
  <span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_y_val'>y_val</span><span class='op'>|</span>
<span class='comment'>#  [-2,-1,0,1,2].each{|y_val|
</span>
    <span class='comment'># confirm condition
</span>    <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_count'>count</span>
    <span class='id identifier rubyid_p'>p</span> <span class='lbracket'>[</span><span class='id identifier rubyid_x_val'>x_val</span><span class='op'>/</span><span class='float'>100.0</span><span class='comma'>,</span><span class='id identifier rubyid_y_val'>y_val</span><span class='op'>/</span><span class='float'>100.0</span><span class='rbracket'>]</span>

    <span class='comment'># calc expanded x,y vectors
</span>    <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_x0'>x0</span><span class='op'>=</span><span class='id identifier rubyid_lines'>lines</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
    <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_xx'>xx</span><span class='op'>=</span><span class='id identifier rubyid_x0'>x0</span><span class='op'>*</span><span class='lparen'>(</span><span class='float'>1.0</span><span class='op'>+</span><span class='id identifier rubyid_x_val'>x_val</span><span class='op'>/</span><span class='float'>100.0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_lines'>lines</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='id identifier rubyid_x0'>x0</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span><span class='id identifier rubyid_xx'>xx</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_lines'>lines</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_y0'>y0</span><span class='op'>=</span><span class='id identifier rubyid_lines'>lines</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
    <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_yy'>yy</span><span class='op'>=</span><span class='id identifier rubyid_y0'>y0</span><span class='op'>*</span><span class='lparen'>(</span><span class='float'>1.0</span><span class='op'>+</span><span class='id identifier rubyid_y_val'>y_val</span><span class='op'>/</span><span class='float'>100.0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_lines'>lines</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='id identifier rubyid_y0'>y0</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span><span class='id identifier rubyid_yy'>yy</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_lines'>lines</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span>

    <span class='comment'># mkdir and write POSCAR
</span>    <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_content'>_calc</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_mkdir'>mkdir</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_t_file'>t_file</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>POSCAR</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>w</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_lines'>lines</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span> <span class='id identifier rubyid_t_file'>t_file</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_t_file'>t_file</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>

    <span class='comment'># set other CARs
</span>    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_cp'>cp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>POTCAR</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span><span class='symbol'>:verbose</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_cp'>cp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>INCAR</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span><span class='symbol'>:verbose</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_cp'>cp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>KPOINTS</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span><span class='symbol'>:verbose</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='rbrace'>}</span>
<span class='rbrace'>}</span>
</code></pre>

<h1>緩和計算結果</h1>

<h2>2223</h2>

<pre class="code ruby"><code class="ruby">sprintf(&quot;%10.5f eV, %10.5f J/m^2 (area:%10.5f A^2)\n&quot;,
                   d_energy, d_energy/(yy*zz)*1.60218*10/2, yy*zz)
&gt; -.11236558E+03-31*(-3.739501247);
                                                       3.5589587

&gt; %/(6.2863189 * 8.0828);
                                                     0.07004299480

&gt; %*1.60218*10/2;
                                                     0.5611074270
</code></pre>

<p>561.1mJ/m^2ですな．</p>

<pre class="code ruby"><code class="ruby">/home/bob/2223/innerelax/succeeded/inner_relax_1_1
-112.30096:0.5600386596598604
/home/bob/2223/innerelax/succeeded/inner_relax_0_0
-112.36558:0.5611074113950909
/home/bob/2223/innerelax/succeeded/inner_relax_1_0
-112.32077:0.562546713905762
/home/bob/2223/innerelax/succeeded/inner_relax_1_2
-112.22028:0.5668396814337117
/home/bob/2223/innerelax/succeeded/inner_relax_1_3
-112.02133:0.591370062890737
/home/bob/2223/innerelax/succeeded/inner_relax_0_3
-112.36584:0.5610664196497437
/home/bob/2223/innerelax/succeeded/inner_relax_0_4
-112.25893:0.5779219100146739
/home/bob/2223/innerelax/succeeded/inner_relax_1_4
-111.59533:0.6494185825492714
/home/bob/2223/innerelax/succeeded/inner_relax_0_2
-112.37954:0.5589064699911566
/home/bob/2223/innerelax/succeeded/inner_relax_0_1
-112.37954:0.5589064699911566
</code></pre>

<p>さてgnuplot．いつも忘れてしまうな．．．</p>
</div></div>

      <div id="footer">
  Generated on Sat Jan  7 13:31:43 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-2.2.2).
</div>

    </div>
  </body>
</html>